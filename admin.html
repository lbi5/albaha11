<script>
let adminName = "";

loginForm.addEventListener('submit', async (e)=>{
  e.preventDefault();
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;

  const res = await fetch('/api/admin-login', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ email, password })
  });
  const data = await res.json();

  if(data.success){
    adminName = data.adminName; // نخزن اسم الإداري
    alert("تم تسجيل الدخول ✅ كـ " + adminName);
    loginBox.style.display = "none";
    adminPanel.style.display = "block";
    loadCars();
    loadLogs();
  } else {
    alert("❌ البريد أو كلمة المرور غير صحيحة");
  }
});

// إرسال اسم الإداري مع كل عملية
document.getElementById("addCarForm").addEventListener("submit", async (e)=>{
  e.preventDefault();
  const formData = new FormData(e.target);
  const res = await fetch('/api/cars', {
    method: 'POST',
    headers: { 'x-admin-name': adminName },
    body: formData
  });
  if((await res.json()).success){
    loadCars();
    loadLogs();
  }
});

// حذف سيارة
async function deleteCar(id){
  if(confirm("هل تريد حذف السيارة؟")){
    await fetch('/api/cars/'+id, { method:'DELETE', headers:{'x-admin-name': adminName} });
    loadCars();
    loadLogs();
  }
}

// تحميل السجلات
async function loadLogs(){
  const res = await fetch('/api/logs');
  const logs = await res.json();
  let logText = "";
  logs.slice().reverse().forEach(l=>{
    logText += `[${l.time}] ${l.admin} - ${l.action} - ${l.details}\n`;
  });
  document.getElementById("logsBox").textContent = logText;
}
</script>

<!-- أسفل لوحة التحكم -->
<div class="panel-section">
  <h3>سجل الإداريين</h3>
  <pre id="logsBox" style="background:#222; padding:10px; border-radius:5px; height:200px; overflow:auto;"></pre>
</div>