<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø³ÙŠØ±ÙØ± Ø§Ù„Ø¨Ø§Ø­Ø©</title>
  <style>
    body {
      margin:0; font-family:Tahoma; background:#111; color:#fff; text-align:center;
    }
    header { background:#222; padding:15px; font-size:20px; }
    .login-box, .admin-panel {
      margin:50px auto; background:#222; padding:20px; border-radius:10px; width:400px;
    }
    input, textarea {
      width:90%; padding:8px; margin:8px; border:none; border-radius:5px;
    }
    button { padding:10px 15px; border:none; border-radius:5px; cursor:pointer; }
    button:hover { opacity:0.8 }
    .car-card {
      background:#333; margin:10px; padding:10px; border-radius:8px; display:inline-block; width:220px;
    }
    img { width:100%; border-radius:5px; }
    .panel-section { margin:30px auto; width:80%; }
    pre { text-align:left; }
  </style>
</head>
<body>
  <header>ğŸš— Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</header>

  <!-- ØµÙ†Ø¯ÙˆÙ‚ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
  <div class="login-box" id="loginBox">
    <h2>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
    <form id="loginForm">
      <input type="email" id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required>
      <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
      <button type="submit">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</button>
    </form>
  </div>

  <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
  <div class="admin-panel" id="adminPanel" style="display:none;">
    <h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ <span id="adminName"></span> ğŸ‘‹</h2>

    <!-- Ø¥Ø¶Ø§ÙØ© Ø³ÙŠØ§Ø±Ø© -->
    <div class="panel-section">
      <h3>â• Ø¥Ø¶Ø§ÙØ© Ø³ÙŠØ§Ø±Ø©</h3>
      <form id="addCarForm" enctype="multipart/form-data">
        <input type="text" name="title" placeholder="Ø§Ø³Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©" required><br>
        <textarea name="description" placeholder="Ø§Ù„ÙˆØµÙ" required></textarea><br>
        <textarea name="specs" placeholder="Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª" required></textarea><br>
        <input type="file" name="image" accept="image/*" required><br>
        <button type="submit">Ø¥Ø¶Ø§ÙØ©</button>
      </form>
    </div>

    <!-- Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ø¶Ø§ÙØ© -->
    <div class="panel-section">
      <h3>ğŸš™ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</h3>
      <div id="carsList"></div>
    </div>

    <!-- Ø§Ù„Ø³Ø¬Ù„Ø§Øª -->
    <div class="panel-section">
      <h3>ğŸ“œ Ø³Ø¬Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠÙŠÙ†</h3>
      <pre id="logsBox" style="background:#000; padding:10px; border-radius:5px; height:200px; overflow:auto;"></pre>
    </div>
  </div>

  <script>
    let adminName = "";

    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    document.getElementById("loginForm").addEventListener("submit", async (e)=>{
      e.preventDefault();
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      const res = await fetch("/api/admin-login", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ email, password })
      });
      const data = await res.json();

      if(data.success){
        adminName = data.adminName;
        document.getElementById("adminName").textContent = adminName;
        document.getElementById("loginBox").style.display = "none";
        document.getElementById("adminPanel").style.display = "block";
        loadCars();
        loadLogs();
      } else {
        alert("âŒ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
      }
    });

    // Ø¥Ø¶Ø§ÙØ© Ø³ÙŠØ§Ø±Ø©
    document.getElementById("addCarForm").addEventListener("submit", async (e)=>{
      e.preventDefault();
      const formData = new FormData(e.target);
      const res = await fetch("/api/cars", {
        method: "POST",
        headers: { "x-admin-name": adminName },
        body: formData
      });
      const data = await res.json();
      if(data.success){
        alert("âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³ÙŠØ§Ø±Ø©");
        loadCars();
        loadLogs();
        e.target.reset();
      }
    });

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª
    async function loadCars(){
      const res = await fetch("/api/cars");
      const cars = await res.json();
      const carsList = document.getElementById("carsList");
      carsList.innerHTML = "";
      cars.forEach(c=>{
        const div = document.createElement("div");
        div.className = "car-card";
        div.innerHTML = `
          <img src="${c.image}" alt="">
          <h4>${c.title}</h4>
          <p>${c.description}</p>
          <small>${c.specs}</small><br>
          <button onclick="deleteCar('${c.id}')">ğŸ—‘ Ø­Ø°Ù</button>
        `;
        carsList.appendChild(div);
      });
    }

    // Ø­Ø°Ù Ø³ÙŠØ§Ø±Ø©
    async function deleteCar(id){
      if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø³ÙŠØ§Ø±Ø©ØŸ")){
        await fetch("/api/cars/"+id, {
          method:"DELETE",
          headers:{ "x-admin-name": adminName }
        });
        loadCars();
        loadLogs();
      }
    }

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª
    async function loadLogs(){
      const res = await fetch("/api/logs");
      const logs = await res.json();
      let logText = "";
      logs.slice().reverse().forEach(l=>{
        logText += `[${l.time}] ${l.admin} - ${l.action} - ${l.details}\n`;
      });
      document.getElementById("logsBox").textContent = logText;
    }
  </script>
</body>
</html>